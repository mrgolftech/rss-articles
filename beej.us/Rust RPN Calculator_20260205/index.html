
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="技术博客文章聚合 - Hacker News 2025年最受欢迎的博客">
      
      
        <meta name="author" content="OpenClaw">
      
      
        <link rel="canonical" href="https://mrgolftech.github.io/rss-articles/beej.us/Rust%20RPN%20Calculator_20260205/">
      
      
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.3">
    
    
      
        <title>Rust RPN Calculator - Hacker News 精选博客</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#rust-rpn-calculator" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="Hacker News 精选博客" class="md-header__button md-logo" aria-label="Hacker News 精选博客" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Hacker News 精选博客
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Rust RPN Calculator
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="切换到深色模式"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="切换到深色模式" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="切换到浅色模式"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="切换到浅色模式" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/mrgolftech/rss-articles" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    rss-articles
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  首页

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../blogs/" class="md-tabs__link">
        
  
  
    
  
  所有博客

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Hacker News 精选博客" class="md-nav__button md-logo" aria-label="Hacker News 精选博客" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Hacker News 精选博客
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mrgolftech/rss-articles" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    rss-articles
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    首页
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../blogs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    所有博客
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/mrgolftech/rss-articles/edit/master/docs/beej.us/Rust RPN Calculator_20260205.md" title="编辑此页" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg>
    </a>
  
  


<h1 id="rust-rpn-calculator">Rust RPN Calculator<a class="headerlink" href="#rust-rpn-calculator" title="Permanent link">&para;</a></h1>
<p><strong>来源:</strong> https://beej.us
<strong>链接:</strong> http://beej.us/blog/data/rust-rpn-calc/
<strong>日期:</strong> Fri, 24 Oct 2025 00:00:00 +0000</p>
<hr />
<h1 id="beejs-bit-bucket-a-tech-and-programming-fun"><a href="../..">Beej's Bit Bucket  â¡ Tech and Programming Fun </a><a class="headerlink" href="#beejs-bit-bucket-a-tech-and-programming-fun" title="Permanent link">&para;</a></h1>
<p>2025-10-24</p>
<h1 id="implementing-an-rpn-calculator-in-rust">Implementing an RPN Calculator in Rust<a class="headerlink" href="#implementing-an-rpn-calculator-in-rust" title="Permanent link">&para;</a></h1>
<p><img alt="HP-48G calculator" src="images/hp48g.jpg" /> The classic <a href="https://en.wikipedia.org/wiki/HP_48_series">HP-48G</a> RPN calculator. This is what I used in college back in 1872.</p>
<p>Welcome back to another edition of <em>Rust Rabbit Holes</em> wherein I attempt to learn a thing or two about Rust by implementing something and poking around. As usual, since I'm far from a Rust expert, I highly value learned feedback if you have it.</p>
<p>The intention is that you just read this through. It's not focused on how to do any one particular thing. It's just train-of-thought exploration.</p>
<p>Today we're going to implement a <a href="https://en.wikipedia.org/wiki/Reverse_Polish_notation">postfix</a> (AKA <em>Reverse Polish Notation</em> , AKA RPN) calculator.</p>
<p>This is inextricably tied to the concept of the <a href="https://en.wikipedia.org/wiki/Stack_(abstract_data_type)"><em>stack</em> abstract data type</a> so read up on that if you have to. We're gonna push and pop!</p>
<h2 id="quick-background">Quick Background<a class="headerlink" href="#quick-background" title="Permanent link">&para;</a></h2>
<p>You're going to be given a list of numbers and operators that look like this:</p>
<div class="language-text highlight"><pre><span></span><code>4 3 +
</code></pre></div>
<p>Reading from left to right, if the item is a number, push it on the stack.</p>
<p>If the item is an operator (we'll stick with <code>+</code> and <code>-</code>), pop the two previous numbers off the stack, perform the operation on them to get a result, and push the result on the stack.</p>
<p>So reading the above, we get:</p>
<div class="language-text highlight"><pre><span></span><code>4: push 4 on the stack

3: push 3 on the stack

+: pop 3 off the stack,
   pop 4 off the stack,
   add 3 + 4 to get 7,
   push 7 on the stack
</code></pre></div>
<p>When we're done with the input, we do this:</p>
<div class="language-text highlight"><pre><span></span><code>pop the stack
print that value out
</code></pre></div>
<p>Which in our example would print <code>7</code>. Which, happily, is <code>4+3</code>.</p>
<p>In regular algebraic notation, we might have an expression that looks like this:</p>
<p>$$(3+10)-(1+7)$$</p>
<p>But with RPN we don't have parentheses; you just have to put stuff on the stack in the correct order.</p>
<p>We definitely want at least this for the above expression:</p>
<div class="language-text highlight"><pre><span></span><code>3 10 +
</code></pre></div>
<p>And when we do that, we'll have <code>[13]</code> on the stack. We can just leave that there for later, though, and do more math.</p>
<div class="language-text highlight"><pre><span></span><code>3 10 + 1 7 +
</code></pre></div>
<p>After that, we'll have <code>[13, 8]</code> on the stack. Which, if you'll notice, are the numbers we want to get the difference between in the original expression. So let's just take the difference:</p>
<div class="language-text highlight"><pre><span></span><code>3 10 + 1 7 + -
</code></pre></div>
<p>Again read it from left to right. If it's a number: push. If it's an operator: pop, pop, do math, push result.</p>
<div class="language-text highlight"><pre><span></span><code>3:  push 3, stack is [3]

10: push 10, stack is [3, 10]

+:  pop 10, stack is [3]
    pop 3, stack is []
    add 3 + 10 to get 13
    push 13, stack is [13]

1:  push 1, stack is [13, 1]

7:  push 7, stack is [13, 1, 7]

+:  pop 7, stack is [13, 1]
    pop 1, stack is [13]
    add 1 + 7 to get 8
    push 8, stack is [13, 8]

-:  pop 8, stack is [13]
    pop 13, stack is []
    subtract 13 - 8 to get 5
    push 5, stack is [5]
</code></pre></div>
<p>And after that we'll have <code>[5]</code> on the stack. And if that's the last operation, we'll pop the <code>5</code> and print it out for the answer.</p>
<h2 id="the-first-stab">The First Stab<a class="headerlink" href="#the-first-stab" title="Permanent link">&para;</a></h2>
<p>This one works. We'll break it down a bit, below, and try to improve it.</p>
<div class="language-text highlight"><pre><span></span><code>fn main() {
    let args: Vec&lt;String&gt; = std::env::args().collect();
    let mut stack: Vec&lt;i64&gt; = Vec::new();

    for a in &amp;args[1..] {
        match a.parse::&lt;i64&gt;() {
            Ok(n) =&gt; stack.push(n),
            Err(_) =&gt; match a.as_str() {
                &quot;+&quot; =&gt; {
                    let o2 = stack.pop().unwrap();
                    let o1 = stack.pop().unwrap();
                    stack.push(o1 + o2);
                }
                &quot;-&quot; =&gt; {
                    let o2 = stack.pop().unwrap();
                    let o1 = stack.pop().unwrap();
                    stack.push(o1 - o2);
                }
                _ =&gt; {
                    println!(&quot;unknown operator {}&quot;, a);
                    std::process::exit(1);
                }
            },
        }
    }

    let result = stack.pop().unwrap();
    println!(&quot;{}&quot;, result);
}
</code></pre></div>
<p>An example run:</p>
<div class="language-text highlight"><pre><span></span><code>$ cargo run 3 10 + 1 7 + -
   Compiling rpncalc v0.1.0 (/home/beej/src/rust/rpncalc)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.09s
     Running `/home/beej/src/rust/rpncalc/target/debug/rpncalc 3 10 + 1 7 + -`
5
</code></pre></div>
<p>And there's my <code>5</code> at the end!</p>
<p><a href="https://doc.rust-lang.org/clippy/usage.html">Clippy</a> gives its seal of approval. But I'm not completely happy.</p>
<h2 id="command-line-arguments">Command Line Arguments<a class="headerlink" href="#command-line-arguments" title="Permanent link">&para;</a></h2>
<p>As we see, the command line arguments accessed with the <a href="https://doc.rust-lang.org/beta/std/env/fn.args.html"><code>std::env::args()</code></a> function.</p>
<p>This returns an <a href="https://doc.rust-lang.org/beta/std/env/struct.Args.html"><code>Args</code> struct</a> that implements <a href="https://doc.rust-lang.org/beta/std/iter/trait.Iterator.html"><code>Iterator</code></a>, so we can do all kinds of iterator-y stuff with it, including <code>collect()</code>ing it into a vector. Which I've done:</p>
<div class="language-text highlight"><pre><span></span><code>let args: Vec&lt;String&gt; = std::env::args().collect();
</code></pre></div>
<p>What that does is take the <code>Args</code> iterator and turn it into a <code>Vec</code> so I can more easily index it.</p>
<p>Notably, I don't want the element at index 0 because that's the name of the executable (typically). But I do want the items at indexes 1-to-the-end. And I do that by getting a slice, like so:</p>
<div class="language-text highlight"><pre><span></span><code>fn main() {
    let args: Vec&lt;String&gt; = std::env::args().collect();

    for a in &amp;args[1..] {
</code></pre></div>
<p>But I'm not super happy with that. I just want to iterate once over the command line arguments, and I'm doing it twice. (Once for the <code>collect()</code> and one for the <code>for</code>-loop.)</p>
<p>We'll steal something from the <a href="https://beej.us/blog/data/rust-trait-impl/">previous blog entry</a> and manually run through the iterator.</p>
<p>And we'll discard the command name (the zero-th argument) before we start the loop.</p>
<p>This also works:</p>
<div class="language-text highlight"><pre><span></span><code>fn main() {
    let mut args = std::env::args();

    let _ = args.next();  // strip off the command name

    while let Some(a) = args.next() {
</code></pre></div>
<p>And that's only one iteration through the arguments.</p>
<p>But it's really just longhand for using an <code>for</code>-<code>in</code> loop:</p>
<div class="language-text highlight"><pre><span></span><code>fn main() {
    let mut args = std::env::args();

    let _ = args.next();  // strip off the command name

    for a in args {
</code></pre></div>
<p>Happier, still!</p>
<h2 id="calling-the-rabbit-hole-collect">Calling The Rabbit Hole Collect<a class="headerlink" href="#calling-the-rabbit-hole-collect" title="Permanent link">&para;</a></h2>
<p>Before the above refactor, we were doing this, and recall that <code>args()</code> returns an <code>Args</code> structure that implements <code>Iterator</code>:</p>
<div class="language-text highlight"><pre><span></span><code>let args: Vec&lt;String&gt; = std::env::args().collect();
</code></pre></div>
<p>Question: why do I have to specify the type of the <code>args</code> variable? Why can't Rust figure it out? Let's dig in.</p>
<p>The <code>collect()</code> method is interesting in that it has no idea what type of thing to collect into. It's a generic method.</p>
<div class="language-text highlight"><pre><span></span><code>fn collect&lt;B&gt;(self) -&gt; B
where
    B: FromIterator&lt;Self::Item&gt;,
    Self: Sized,
</code></pre></div>
<p><code>Self: Sized</code> means the thing being collected, <code>Args</code>, needs to be <a href="https://doc.rust-lang.org/std/marker/trait.Sized.html"><code>Sized</code></a>, meaning that it has a compile-time known size. So here <code>Self</code> refers to <code>Args</code>, the thing on which <code>.collect()</code> is being called. And from what I can tell it's important to be <code>Sized</code> when moving ownership for generating code for which the size needs to be known, e.g. stack space.</p>
<p>The important bit is <code>B: FromIterator&lt;Self::Item&gt;</code>. This means whatever we're collecting into, <code>B</code>, needs to implement <code>FromIterator&lt;Self::Item&gt;</code>. Hmm!</p>
<p>Okay, <code>B</code> in this case is <code>Vec&lt;String&gt;</code> because that's the type we used. Does it implement <code>FromIterator&lt;Self::Item&gt;</code>?</p>
<p>Well, <a href="https://doc.rust-lang.org/std/vec/struct.Vec.html#impl-FromIterator%3CT%3E-for-Vec%3CT%3E"><code>Vec</code> implements <code>FromIterator&lt;T&gt;</code></a> according to the documentation. So that's good. This is the trait that allows it to be collectedâanything implementing this trait is eligible (as long as it's <code>Sized</code>).</p>
<p>What's <code>Self::Item</code>? We saw <code>Self</code> referred to the <code>Args</code> type. Where is <code>Item</code> and what is it?</p>
<p>If we look at the source for <a href="https://doc.rust-lang.org/beta/std/iter/trait.Iterator.html"><code>Iterator</code></a>, we see this at the top:</p>
<div class="language-text highlight"><pre><span></span><code>pub trait Iterator {
    type Item;         // â There it is!

    // Required method
    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt;;
</code></pre></div>
<p>What is this <code>type Item</code> stuff in the trait? Turns out that's an <a href="https://doc.rust-lang.org/book/ch20-02-advanced-traits.html#specifying-placeholder-types-in-trait-definitions-with-associated-types"><em>associated type</em></a>, a way of bundling some additional type information along with an implementation of the trait. For example, I might be making my own iterator that implements <code>Iterator</code> over the type I happen to be using, say <code>u64</code>. In that case, I could do this:</p>
<div class="language-text highlight"><pre><span></span><code>impl Iterator for MyStruct {
    type Item = u64;

    //...
}
</code></pre></div>
<p>Now if someone uses a <code>MyStruct</code> as an iterator, the type held within (<code>u64</code>) is automatically bundled along with the iterator. If we didn't have this, we'd have to add it as another generic type. That's a lot less ergonomic, among other things.</p>
<blockquote>
<p>More reading:</p>
<ul>
<li><a href="https://doc.rust-lang.org/book/ch20-02-advanced-traits.html#specifying-placeholder-types-in-trait-definitions-with-associated-types">The Rust Book, <em>Associated Types</em></a></li>
<li><a href="https://doc.rust-lang.org/rust-by-example/generics/assoc_items/types.html">Rust by Example, <em>Associated Types</em></a></li>
<li><a href="https://github.com/rust-lang/rfcs/blob/master/text/0195-associated-items.md">RFC 195, <em>Associated Items</em></a></li>
<li><a href="https://www.reddit.com/r/rust/comments/14twron/why_do_you_need_associated_types_in_rust_why_not/">Reddit, <em>Why do you need associated types?</em></a>
</li>
</ul>
</blockquote>
<p>Sure enough, if we <a href="https://doc.rust-lang.org/beta/src/std/env.rs.html#867-889">look at the <code>Args</code> source</a>, we see:</p>
<div class="language-text highlight"><pre><span></span><code>impl Iterator for Args {
    type Item = String;
</code></pre></div>
<p>There we go.</p>
<p>So, to answer my question, I have to specify the type as <code>Vec&lt;String&gt;</code> and then Rust can figure out <code>Item</code> from the type we're assigning into. If we left the type off, it would be an error because... Rust doesn't know what the type of <code>Item</code> is?</p>
<p>No, wait. Rust has that information. <code>args()</code> returns an <code>Args</code>, which implements <code>Iterator</code> with <code>type Item = String</code>. It knows it's getting <code>String</code>s out of it.</p>
<p>What it doesn't know is that I want this in a <code>Vec</code>! All <code>collect()</code> knows, in this case, is that it's collecting into something that implements <code>FromIterator&lt;String&gt;</code>. That could be a <code>Vec</code> or it could be an <code>Antelope</code>. So we have to say:</p>
<div class="language-text highlight"><pre><span></span><code>let args: Vec&lt;String&gt; = std::env::args().collect();
</code></pre></div>
<p>Actually, since it knows the <code>String</code> part, we can just let the compiler fill that in, too. We only need <code>Vec</code>. Here's how:</p>
<div class="language-text highlight"><pre><span></span><code>let args: Vec&lt;_&gt; = std::env::args().collect();
</code></pre></div>
<p>All that said, we could also do it the other way and tell <code>collect()</code> exactly what type to use. That uses <a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.collect"><em>turbo fish</em></a> notation (<code>::&lt;&gt;</code>):</p>
<div class="language-text highlight"><pre><span></span><code>let args = std::env::args().collect::&lt;Vec&lt;String&gt;&gt;();
let args = std::env::args().collect::&lt;Vec&lt;_&gt;&gt;();      // Or this
</code></pre></div>
<p>I didn't have to give <code>args</code> a type; the compiler infers it from the right hand side. Let's look at <code>collect()</code> again:</p>
<div class="language-text highlight"><pre><span></span><code>fn collect&lt;B&gt;(self) -&gt; B
</code></pre></div>
<p>What the turbo fish does is it sets type that <code>B</code> is. Earlier, with the type <code>Vec&lt;String&gt;</code> attached to <code>args</code>, the compiler could fill <code>B</code> in itself, inferring it from the type of <code>args</code>. Now, with <code>Vec&lt;String&gt;</code> attached to the <code>collect()</code>, the compiler can infer the type of <code>args</code> in that direction.</p>
<p>Same thing, different way. Personally I prefer the type attached to the variable for readability, but that's just me.</p>
<p>We could do both:</p>
<div class="language-text highlight"><pre><span></span><code>let args: Vec&lt;String&gt; = std::env::args().collect::&lt;Vec&lt;String&gt;&gt;();
</code></pre></div>
<p>but that's just redundantly redundant.</p>
<h2 id="parsing-tokens">Parsing Tokens<a class="headerlink" href="#parsing-tokens" title="Permanent link">&para;</a></h2>
<p>There are two kinds of tokens in our RPN calculator: numbers and operators. We'll differentiate by trying to parse it as a number, then, if that fails, trying to see if it's a valid token.</p>
<p>Here's how to parse a string into a type like we did with <code>.parse()</code> in the original code at the top of the page. Keep in mind that <code>a</code> is a <code>String</code>, so <code>.parse&lt;F&gt;()</code> must be a method on <code>String</code>, and it is.</p>
<div class="language-text highlight"><pre><span></span><code>match a.parse::&lt;i64&gt;() {
</code></pre></div>
<p>And there's the turbo fish again. In this case we're not doing an assignment so we can't specify a type on the left, and we're forced to use it. Let's dig a bit into these traits.</p>
<p>This is what we have for <code>parse()</code>:</p>
<div class="language-text highlight"><pre><span></span><code>pub fn parse&lt;F&gt;(&amp;self) -&gt; Result&lt;F, &lt;F as FromStr&gt;::Err&gt;
where
    F: FromStr,
</code></pre></div>
<p>So the type we specify in the turbo fish has to implement <code>FromStr</code>. Does <code>i64</code> do that? <a href="https://doc.rust-lang.org/std/primitive.i64.html#impl-FromStr-for-i64">Yes, it does</a>. Lots of things do.</p>
<p>This is interesting to me because it means that all the individual types that implement <code>FromStr</code> handle their own parsing. Floats will do their parsing independent of the integers that do theirs.</p>
<p>This actually makes the <code>parse()</code> code in <code>String</code> dirt-simple:</p>
<div class="language-text highlight"><pre><span></span><code>pub fn parse&lt;F: FromStr&gt;(&amp;self) -&gt; Result&lt;F, F::Err&gt; {
    FromStr::from_str(self)
}
</code></pre></div>
<p>That's it. All we need to do is somehow specify what <code>&lt;F&gt;</code> is and the appropriate <code>from_str()</code> method is called.</p>
<h2 id="using-the-stack-and-errors">Using the Stack and Errors<a class="headerlink" href="#using-the-stack-and-errors" title="Permanent link">&para;</a></h2>
<p>So we try to parse the number, and if that works, we push it on the stack, otherwise we start checking to see if the argument is an operator. If it is an operator, we pop the operands, do the operation, and push the result on the stack.</p>
<div class="language-text highlight"><pre><span></span><code>Ok(n) =&gt; stack.push(n),          // parse() succeded
Err(_) =&gt; match a.as_str() {     // parse() failed
    &quot;+&quot; =&gt; {
        let o2 = stack.pop().unwrap();
        let o1 = stack.pop().unwrap();
        stack.push(o1 + o2);
    }
</code></pre></div>
<p>We have those pesky <code>unwrap()</code> calls in there. These operate on <code>Option</code>s or <code>Result</code>s and try to get to the <code>Ok()</code> or <code>Some()</code> that's embedded within them. If it's <code>Err()</code> or <code>None</code>, <code>unwrap()</code> will crash the program. It's pretty heavy-handed and crashes are typically not a desirable quality in any given piece of software.</p>
<p>I can force this to happen by computing <code>1 +</code>. (That'll try to pop two things off the stack, but there's only one, so the second <code>pop()</code> will return <code>None</code> and <code>unwrap()</code> will bomb out at that point.)</p>
<div class="language-text highlight"><pre><span></span><code>$ cargo run 1 +
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.01s
     Running `/home/beej/src/rust/rpncalc/target/debug/rpncalc 1 +`

thread &#39;main&#39; panicked at src/main.rs:14:42:
called `Option::unwrap()` on a `None` value
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre></div>
<p>So it's not super-robust.</p>
<p>We could nest more <code>match</code>es, or push these into functions (would certainly be better than nesting). We could also use <code>if let</code>, but this is positively obnoxious:</p>
<div class="language-text highlight"><pre><span></span><code>let mut o1 = 0i64;
let mut o2 = 0i64;

if let Some(t) = stack.pop() {
    o2 = t;
} else {
    println!(&quot;missing argument&quot;);
}
if let Some(t) = stack.pop() {
    o1 = t;
} else {
    println!(&quot;missing argument&quot;);
}

stack.push(o1 + o2);
</code></pre></div>
<p>We can actually clean that up with a tuple assignment like so:</p>
<div class="language-text highlight"><pre><span></span><code>if let (Some(o2), Some(o1)) = (stack.pop(), stack.pop()) {
    stack.push(o1 + o2);
} else {
    println!(&quot;missing argument&quot;);
}
</code></pre></div>
<p>Those <code>stack.pop()</code> calls definitely have side-effects, so they'd better be in the right order! Rust guarantees left-to-right evaluation in the tuple, so that should be fine.</p>
<p>That's cleaner for sure, and we got rid of some of our <code>unwrap()</code>s and put in some rudimentary error handling.</p>
<p>But can we do better? Maybe it's best to restructure this to flatten it out a bit.</p>
<p>We could check to see if we got a number, and if we did, push it and continue.</p>
<p>Otherwise, we could do our match.</p>
<div class="language-text highlight"><pre><span></span><code>for a in args {

    if let Ok(n) = a.parse::&lt;i64&gt;() {
        stack.push(n);
        continue;  // next iteration
    }

    match a.as_str() {
        &quot;+&quot; =&gt; {
            if let (Some(o2), Some(o1)) = (stack.pop(), stack.pop()) {
                stack.push(o1 + o2);
            } else {
                println!(&quot;missing argument&quot;);
            }
        }
</code></pre></div>
<p>That gets rid of the <code>match</code>-in-<code>match</code> nesting. Nothing particularly Rusty, hereâjust some run-of-the-mill restructuring.</p>
<p>But I have some repeated code in that <code>match</code>.</p>
<div class="language-text highlight"><pre><span></span><code>match a.as_str() {
    &quot;+&quot; =&gt; {
        if let (Some(o2), Some(o1)) = (stack.pop(), stack.pop()) {
            stack.push(o1 + o2);
        } else {
            println!(&quot;missing argument&quot;);
        }
    }
    &quot;-&quot; =&gt; {
        if let (Some(o2), Some(o1)) = (stack.pop(), stack.pop()) {
            stack.push(o1 - o2);
        } else {
            println!(&quot;missing argument&quot;);
        }
    }
</code></pre></div>
<p>And if we add more operators, it's just going to get worse. I want some general code to pop two things, perform some operation, and then push them. One way to do this is with an anonymous function, which is called a <em>closure</em> in Rust and some other languages.</p>
<p>Here's how this might work:</p>
<div class="language-text highlight"><pre><span></span><code>match a.as_str() {
    &quot;+&quot; =&gt; math_op(&amp;mut stack, |x, y| x + y),
    &quot;-&quot; =&gt; math_op(&amp;mut stack, |x, y| x - y),
    _ =&gt; {
        println!(&quot;unknown operator {}&quot;, a);
        std::process::exit(1);
    }
</code></pre></div>
<p>Oooo... so much cleaner! But what is this?</p>
<div class="language-text highlight"><pre><span></span><code>math_op(&amp;mut stack, |x, y| x + y)
</code></pre></div>
<p><code>math_op()</code> is (will be) a function that takes two arguments. The first is a mutable reference to the stack. The second is a closureâit's a function that accepts two arguments (in parameters <code>x</code> and <code>y</code>) and returns the result of the expression after it. (Nothing magical about the return; <code>x+y</code> is the last line in the closure, so it takes on the return value.)</p>
<p>All that's left is to code up the <code>math_op()</code> function. Great. We'll use parameter <code>f</code> to represent the closure function.</p>
<div class="language-text highlight"><pre><span></span><code>fn math_op(stack: &amp;mut Vec, f ...
</code></pre></div>
<p>What type is that? Well, we could rabbit hole on this one, but I don't want to get too far off track. Here's my understanding, which is somewhat incomplete.</p>
<p>Rust has a trait, <code>FnOnce</code>, that represents a function (meant to be called once). Closures implement this trait.</p>
<p>In this case, we know we know our closure implements this in particular:</p>
<div class="language-text highlight"><pre><span></span><code>FnOnce(i64, i64) -&gt; i64
</code></pre></div>
<p>Our closures take two <code>i64</code>s as arguments and return an <code>i64</code>.</p>
<p>We might be tempted to:</p>
<div class="language-text highlight"><pre><span></span><code>fn math_op(stack: &amp;mut Vec, f: FnOnce(i64, i64) -&gt; i64) // NOPE
</code></pre></div>
<p>But that won't compile. <code>FnOnce</code> is a <em>trait</em> , not a type. But we can certainly use generics to enforce it!</p>
<div class="language-text highlight"><pre><span></span><code>fn math_op&lt;A&gt;(stack: &amp;mut Vec, f: A)
where
    A: FnOnce(i64, i64) -&gt; i64,
</code></pre></div>
<p>Which says the second argument <code>f</code> is of generic type <code>A</code> where <code>A</code> is required to implement <code>FnOnce(i64, i64) -&gt; i64</code>. Which our closures do.</p>
<p>So the <code>math_op()</code> function will look like this:</p>
<div class="language-text highlight"><pre><span></span><code>fn math_op&lt;A&gt;(stack: &amp;mut Vec&lt;i64&gt;, f:A)
where
    A: FnOnce(i64, i64) -&gt; i64,
{
    if let (Some(o2), Some(o1)) = (stack.pop(), stack.pop()) {
        let result = f(o1, o2);
        stack.push(result);
    } else {
        println!(&quot;missing argument&quot;);
    }
}
</code></pre></div>
<p>And we can call it like we planned:</p>
<div class="language-text highlight"><pre><span></span><code>match a.as_str() {
    &quot;+&quot; =&gt; math_op(&amp;mut stack, |x, y| x + y),
    &quot;-&quot; =&gt; math_op(&amp;mut stack, |x, y| x - y),
</code></pre></div>
<p>Slick!</p>
<p>One final rabbit hole fun fact for the section is that all functions actually implement <code>FnOnce</code>. So I could have a completely separate function like this:</p>
<div class="language-text highlight"><pre><span></span><code>fn subtract(x: i64, y: i64) -&gt; i64 {
    x - y
}
</code></pre></div>
<p>and then use it in my <code>match</code>:</p>
<div class="language-text highlight"><pre><span></span><code>match a.as_str() {
    &quot;+&quot; =&gt; math_op(&amp;mut stack, |x, y| x + y),
    &quot;-&quot; =&gt; math_op(&amp;mut stack, subtract),     // Works!
</code></pre></div>
<p>All kinds of fun with function pointers! Woot! This goes down a path to visit on another day.</p>
<h2 id="get-some-results">Get Some Results<a class="headerlink" href="#get-some-results" title="Permanent link">&para;</a></h2>
<p>I'm almost happy with that, but really <code>math_op()</code> should be returning some kind of <code>Result</code> instead of printing the error message. But then don't we have to handle that in the caller and mess up all our clean code?</p>
<p>Yes... But maybe there's a way. Right now it's all in one big main, but we could break out the main code into another function, and <em>that</em> function could just propagate the error back to <code>main()</code> which could handle it. That makes sense in this case since invalid operands should be completely fatal to the run.</p>
<p>But can we get our hands on that <code>Result</code> and check it another way?</p>
<p>Coming from other languages, I forget that in Rust <code>match</code> (and other) statements can act as expressions and we can "return" things from them.</p>
<p>Let's change the <code>math_op()</code> to return a <code>Result</code>:</p>
<div class="language-text highlight"><pre><span></span><code>fn math_op&lt;A&gt;(stack: &amp;mut Vec&lt;i64&gt;, f: A) -&gt; Result&lt;(), &amp;&#39;static str&gt;
where
    A: FnOnce(i64, i64) -&gt; i64,
{
    if let (Some(o2), Some(o1)) = (stack.pop(), stack.pop()) {
        let result = f(o1, o2);
        stack.push(result);
        Ok(())
    } else {
        Err(&quot;missing argument&quot;)
    }
}
</code></pre></div>
<p>And now when we use it in the <code>match</code> and then see if the <code>Result</code> holds an <code>Err</code> after that:</p>
<div class="language-text highlight"><pre><span></span><code>let result = match a.as_str() {
    &quot;+&quot; =&gt; math_op5(&amp;mut stack, |x, y| x + y),
    &quot;-&quot; =&gt; math_op5(&amp;mut stack, |x, y| x - y),
    _ =&gt; Err(&quot;unknown operator&quot;),
};

if let Err(e) = result {
    eprintln!(&quot;Error: {} at token {}&quot;, e, a);
    std::process::exit(1);
}
</code></pre></div>
<p>Now it's a little beefier.</p>
<h2 id="the-final-code">The Final Code<a class="headerlink" href="#the-final-code" title="Permanent link">&para;</a></h2>
<p>I'd throw this in the <a href="https://play.rust-lang.org/">Rust Playground</a>, but it apparently doesn't support command line arguments. So here it is.</p>
<div class="language-text highlight"><pre><span></span><code>fn math_op&lt;A&gt;(stack: &amp;mut Vec&lt;i64&gt;, f: A) -&gt; Result&lt;(), &amp;&#39;static str&gt;
where
    A: FnOnce(i64, i64) -&gt; i64,
{
    if let (Some(o2), Some(o1)) = (stack.pop(), stack.pop()) {
        let result = f(o1, o2);
        stack.push(result);
        Ok(())
    } else {
        Err(&quot;missing argument&quot;)
    }
}

fn main() {
    let mut args = std::env::args();
    let mut stack: Vec&lt;i64&gt; = Vec::new();

    let _ = args.next();

    for a in args {
        if let Ok(n) = a.parse::&lt;i64&gt;() {
            stack.push(n);
            continue; // next iteration
        }

        let result = match a.as_str() {
            &quot;+&quot; =&gt; math_op(&amp;mut stack, |x, y| x + y),
            &quot;-&quot; =&gt; math_op(&amp;mut stack, |x, y| x - y),
            _ =&gt; Err(&quot;unknown operator&quot;),
        };

        if let Err(e) = result {
            eprintln!(&quot;Error: {} at token {}&quot;, e, a);
            std::process::exit(1);
        }
    }

    if let Some(result) = stack.pop() {
        println!(&quot;{}&quot;, result);
    } else {
        eprintln!(&quot;Error: empty stack&quot;);
        std::process::exit(2);
    }
}
</code></pre></div>
<p>Good rabbit holes in this one.</p>
<h2 id="further-reading">Further Reading<a class="headerlink" href="#further-reading" title="Permanent link">&para;</a></h2>
<p>If you really want to learn more fun things about RPN math, read up on <a href="https://en.wikipedia.org/wiki/Shunting_yard_algorithm">The Shunting Yard algorithm</a> which takes a "regular" algebraic expression in <em>infix</em> notation and converts it to the postfix notation we used in this blog.</p>
<h2 id="comments">Comments<a class="headerlink" href="#comments" title="Permanent link">&para;</a></h2>
<p><a href="https://mastodon.sdf.org/@beejjorgensen/115432898842626559">View Comments</a> <a href="https://mastodon.sdf.org/@beejjorgensen/115432898842626559">Reply</a></p>
<p>Click on "View Comments" to see the comments.</p>
<p><a href="http://beej.us/blog/"><strong>Blog</strong></a>  â¡  <a href="mailto:beej@beej.us"><strong>beej@beej.us</strong></a>  â¡  <a href="http://beej.us/"><strong>Home page</strong></a></p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最后更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="2026年2月27日 04:51:49 UTC">2026-02-27</span>
  </span>

    
    
    
    
  </aside>


  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        这篇文章有帮助吗？
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="有帮助" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 9v12H1V9zm4 12a2 2 0 0 1-2-2V9c0-.55.22-1.05.59-1.41L14.17 1l1.06 1.06c.27.27.44.64.44 1.05l-.03.32L14.69 8H21a2 2 0 0 1 2 2v2c0 .26-.05.5-.14.73l-3.02 7.05C19.54 20.5 18.83 21 18 21zm0-2h9.03L21 12v-2h-8.79l1.13-5.32L9 9.03z"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="没帮助" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 15V3h4v12zM15 3a2 2 0 0 1 2 2v10c0 .55-.22 1.05-.59 1.41L9.83 23l-1.06-1.06c-.27-.27-.44-.64-.44-1.06l.03-.31.95-4.57H3a2 2 0 0 1-2-2v-2c0-.26.05-.5.14-.73l3.02-7.05C4.46 3.5 5.17 3 6 3zm0 2H5.97L3 12v2h8.78l-1.13 5.32L15 14.97z"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              
              
                
                
              
              感谢反馈！
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              
              
                
                
              
              感谢反馈！我们会改进。
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2026 - OpenClaw
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/mrgolftech" target="_blank" rel="noopener" title="GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.action.edit"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>