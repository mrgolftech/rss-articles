# Exploring the signals the dialog manager uses for dismissing a dialog

**来源:** [devblogs.microsoft.com/oldnewthing](https://devblogs.microsoft.com/oldnewthing)
**发布时间:** Thu, 19 Feb 2026 15:00:00 +0000
**链接:** https://devblogs.microsoft.com/oldnewthing/20260219-00/?p=112072

---

{'type': 'text/html', 'language': None, 'base': 'https://devblogs.microsoft.com/oldnewthing/feed', 'value': '<p>There are a few different built-in ways to close a dialog box in the classic Windows dialog manager. Let&#8217;s run them down.</p>\n<p>First, there&#8217;s hitting the <kbd>ESC</kbd> key.</p>\n<p>The <kbd>ESC</kbd> key, as with all keyboard navigation, is handled by the <code>Is\xadDialog\xadMessage</code> function. Assuming that the dialog control with focus did not use the <code>WM_GET\xadDLG\xadCODE</code> message to override default keyboard handling, the <code>Is\xadDialog\xadMessage</code> function converts the <kbd>ESC</kbd> to a simulated button click of whatever dialog control has the ID <code>IDCANCEL</code>. Specifically, the message is <code>WM_COMMAND</code>, the notification code is <code>BN_CLICKED</code>, the control ID is <code>IDCANCEL</code>, and the window handle is the handle to whatever dialog control has the ID <code>IDCANCEL</code> (or <code>nullptr</code> if there is no such control).</p>\n<p><b>Exception</b>: If there is a control whose ID is <code>IDCANCEL</code>, and that control is disabled, then the <code>Is\xadDialog\xadMessage</code> function merely beeps and otherwise ignores the <kbd>ESC</kbd> key.</p>\n<p>Okay, what about the Close button in the title bar, the one that looks like an ×?</p>\n<p>The Close button in the title bar, double-clicking the dialog box icon (if there is one), selecting Close from the system menu, and pressing <kbd>Alt</kbd>+<kbd>F4</kbd> all behave the same way: They generate a <code>WM_SYSCOMMAND</code> message whose <code>wParam &amp; 0xFFF0</code> is <code>SC_CLOSE</code>. The default window procedure turns this into a <code>WM_CLOSE</code> message. The default dialog procedure responds to the <code>WM_CLOSE</code> in basically the same way that <code>Is\xadDialog\xadMessage</code> does: It generates a simulated button click of whatever dialog control has the ID <code>IDCANCEL</code>. Again, this is done by converting it to the <code>WM_COMMAND</code> message, with a notification code of <code>BN_CLICKED</code>, a control ID of <code>IDCANCEL</code>, and the handle to whatever dialog control has the ID <code>IDCANCEL</code> (or <code>nullptr</code> if there is no such control). It also has the same exception: If there is a control whose ID is <code>IDCANCEL</code>, and that control is disabled, then the default dialog procedure just beeps and otherwise ignores the message.</p>\n<p>Now that we understand what happens, next time we can look at ways of customizing the behavior.</p>\n<p><b>Bonus chatter</b>: You can see from this that the dialog manager is wired to treat a control with the ID <code>IDCANCEL</code> as if it were a Cancel button, so <a href="https://devblogs.microsoft.com/oldnewthing/20080508-00/?p=22403" title="Gentle reminder: On a dialog box, do not give OK and Cancel accelerators"> if you have a Cancel button, give it the ID <code>IDCANCEL</code></a>. Conversely, if you have a control whose ID is <code>IDCANCEL</code>, it had better be a button if you know what&#8217;s good for you.</p>\n<p>The post <a href="https://devblogs.microsoft.com/oldnewthing/20260219-00/?p=112072">Exploring the signals the dialog manager uses for dismissing a dialog</a> appeared first on <a href="https://devblogs.microsoft.com/oldnewthing">The Old New Thing</a>.</p>'}

---

*抓取时间: 2026-02-21 00:09:53*
