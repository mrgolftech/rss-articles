# How can I distinguish between the numeric keypad 0 and the top-row 0 in the WM_CHAR message?

**来源:** [devblogs.microsoft.com/oldnewthing](https://devblogs.microsoft.com/oldnewthing)
**发布时间:** Fri, 13 Feb 2026 15:00:00 +0000
**链接:** https://devblogs.microsoft.com/oldnewthing/20260213-00/?p=112062

---

{'type': 'text/html', 'language': None, 'base': 'https://devblogs.microsoft.com/oldnewthing/feed', 'value': '<p>Last time, we looked at <a href="https://devblogs.microsoft.com/oldnewthing/20260212-00/?p=112059" title="How can I distinguish between the numeric keypad 0 and the top-row 0 in the WM_KEY\xadDOWN message?"> how to distinguish the numeric keypad 0 and the top-row 0 in the <code>WM_KEY\xadDOWN</code> message</a>. We may as well look at the analogous table for <code>WM_CHAR</code>.</p>\n<table border="1" cellpadding="3" cellspacing="0" style="border-collapse: collapse;">\n<tbody>\n<tr>\n<th>Event</th>\n<th>wParam</th>\n<th>Extended?</th>\n</tr>\n<tr>\n<td>Numpad0 with NumLock on</td>\n<td><tt>VK_0</tt></td>\n<td>0</td>\n</tr>\n<tr>\n<td>Numpad0 with NumLock off</td>\n<td colspan="2" style="text-align: center;">(no <code>WM_CHAR</code>)</td>\n</tr>\n<tr>\n<td><kbd>Ins</kbd> key</td>\n<td colspan="2" style="text-align: center;">(no <code>WM_CHAR</code>)</td>\n</tr>\n<tr>\n<td>0 on top row</td>\n<td><tt>VK_0</tt></td>\n<td>0</td>\n</tr>\n</tbody>\n</table>\n<p>I got the name <code>VK_0</code> from this comment block in <tt>winuser.h</tt>.</p>\n<pre>/*\n * VK_0 - VK_9 are the same as ASCII \'0\' - \'9\' (0x30 - 0x39)\n * 0x3A - 0x40 : unassigned\n * VK_A - VK_Z are the same as ASCII \'A\' - \'Z\' (0x41 - 0x5A)\n */\n</pre>\n<p>Uh-oh. The extended bit doesn&#8217;t distinguish between the two. They both show up as <code>VK_0</code>, non-extended.</p>\n<p>What changes is something not in the above table: The scan code.</p>\n<p>So let&#8217;s convert the scan code back to a virtual key.</p>\n<pre>auto vk_from_scan = MapVirtualKey((lParam &gt;&gt; 16) &amp; 0xFF, MAPVK_VSC_TO_VK);\n</pre>\n<table border="1" cellpadding="3" cellspacing="0" style="border-collapse: collapse;">\n<tbody>\n<tr>\n<th>Event</th>\n<th>wParam</th>\n<th>Extended?</th>\n<th><tt>vk_from_scan</tt></th>\n</tr>\n<tr>\n<td>Numpad0 with NumLock on</td>\n<td><tt>VK_0</tt></td>\n<td>0</td>\n<td><tt>VK_INSERT</tt></td>\n</tr>\n<tr>\n<td>Numpad0 with NumLock off</td>\n<td colspan="3" style="text-align: center;">(no <code>WM_CHAR</code>)</td>\n</tr>\n<tr>\n<td><kbd>Ins</kbd> key</td>\n<td colspan="3" style="text-align: center;">(no <code>WM_CHAR</code>)</td>\n</tr>\n<tr>\n<td>0 on top row</td>\n<td><tt>VK_0</tt></td>\n<td>0</td>\n<td><tt>VK_0</tt></td>\n</tr>\n</tbody>\n</table>\n<p>So we can infer which zero was pressed by taking the scan code, mapping it to a virtual key, and seeing whether it&#8217;s the <kbd>Ins</kbd> key (from the numeric keypad) or the <kbd>0</kbd> key (from the top row).</p>\n<p>But wait, we&#8217;re not done yet.</p>\n<p>There are ways to type the character <tt>0</tt> without using the numeric keypad or the top row. For example, you can hold the <kbd>Alt</kbd> key and then type <kbd>4</kbd>,<kbd>8</kbd> on the numeric keypad, and that will type a <tt>0</tt>. I tried it out, and the <code>vk_from_scan</code> was <code>VK_MENU</code>, which is the virtual key code for the <kbd>Alt</kbd> key. Another way of entering a <tt>0</tt> is by using an input method editor (IME). Or there might be a custom keyboard layout that generates a <tt>0</tt> through some wacky chord sequence.</p>\n<p>Therefore, if the <code>vk_from_scan</code> is neither <code>VK_INSERT</code> nor <code>VK_0</code>, you have to conclude that the <tt>0</tt> was entered by some means other than the numeric keypad or the top row.</p>\n<p>The post <a href="https://devblogs.microsoft.com/oldnewthing/20260213-00/?p=112062">How can I distinguish between the numeric keypad 0 and the top-row 0 in the &lt;CODE&gt;WM_&lt;WBR&gt;CHAR&lt;/CODE&gt; message?</a> appeared first on <a href="https://devblogs.microsoft.com/oldnewthing">The Old New Thing</a>.</p>'}

---

*抓取时间: 2026-02-15 00:03:08*
