# It rather involved being on the other side of the airtight hatchway: Tricking(?) a program into reading files

**来源:** [devblogs.microsoft.com/oldnewthing](https://devblogs.microsoft.com/oldnewthing)
**发布时间:** Mon, 16 Feb 2026 15:00:00 +0000
**链接:** https://devblogs.microsoft.com/oldnewthing/20260216-00/?p=112065

---

{'type': 'text/html', 'language': None, 'base': 'https://devblogs.microsoft.com/oldnewthing/feed', 'value': '<p>A security vulnerability report came in that claimed that a program was vulnerable to information disclosure when run as an administrator because it opened whatever file you passed on the command line and read from it, before reporting an error because the file is in the incorrect format.</p>\n<p>They identified multiple issues.</p>\n<ul>\n<li>The program does no path validation. It accepts any file name and blindly opens it and reads its contents.</li>\n<li>The program does not block path traversal via <tt>..</tt>.</li>\n<li>The program does not check that the file is in an approved directory.</li>\n<li>The program does not validate that the user has permission to access the file.</li>\n<li>The program does not validate that the file is in the correct format before opening it.</li>\n</ul>\n<p>According to the report, all of these defects lead to information disclosure.</p>\n<p>Okay, as usual, we have to figure out who the attacker is, who the victim is, and what the attacker has gained.</p>\n<p>The attacker is, presumably, the person running the carefully-crafted command line.</p>\n<p>The victim is, presumably, the person whose file contents are disclosed.</p>\n<p>But those are the same person!</p>\n<p>Remember, the security term &#8220;information disclosure&#8221; is just a shorthand for <i>unauthorized</i> information disclosure. It is not a security vulnerability to disclose information to someone who is authorized to see it.</p>\n<p>In this case, it&#8217;s fine for the program to take the information from the user and use it to access a file while running as that user. The security check happens as that user, so it&#8217;s not true that &#8220;The program does not validate that the user has permission to access the file.&#8221; The validation happens when the program tries to open the file and maybe gets &#8220;access denied&#8221; if they don&#8217;t have access.</p>\n<p>The claim that there is no &#8220;approved directory&#8221; check is a bit spurious, since the program doesn&#8217;t have any concept of an &#8220;approved directory&#8221; to begin with.</p>\n<p>There is nothing wrong with directory traversal or the lack of path validation, because the file is opened as the user. If the path contains traversals, the security system verifies that the user has permission to traverse those directories. If the provided path is illegal, then the open call will fail with an &#8220;invalid file name&#8221;. The underlying <code>Create\xadFile</code> call does the validation. Let the security system do the security checks. Don&#8217;t try to duplicate their work, because you&#8217;re probably going to duplicate it incorrectly and introduce a security vulnerability.</p>\n<p>If you think about it, the finder&#8217;s complaints about this program also apply to the <code>TYPE</code> command. It opens the file whose path is provided as the command line argument and prints it to the screen. So why did they file the security issue against this program? Probably because it makes their report sound more interesting.</p>\n<p><b>Bonus chatter</b>: The finder also considered it a security vulnerability that the program does not validate that the file is in the correct format before opening it. But how could it validate the file format without opening the file, reading the contents, and validating those contents? This is like handing someone a sealed envelope and saying, &#8220;Don&#8217;t read the enclosed letter if it contains spelling errors. But if it&#8217;s error-free, follow the instructions written in the letter.&#8221; Do they expect the program to be psychic and know whether the file contents are valid without reading it? If so, then why even open the file at all? You already used psychic powers to know what&#8217;s in the file, so just operate on the file contents you determined via your psychic powers.</p>\n<p>The post <a href="https://devblogs.microsoft.com/oldnewthing/20260216-00/?p=112065">It rather involved being on the other side of the airtight hatchway: Tricking(?) a program into reading files</a> appeared first on <a href="https://devblogs.microsoft.com/oldnewthing">The Old New Thing</a>.</p>'}

---

*抓取时间: 2026-02-18 18:04:18*
