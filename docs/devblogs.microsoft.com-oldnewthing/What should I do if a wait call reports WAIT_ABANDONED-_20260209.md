# What should I do if a wait call reports WAIT_ABANDONED?

**来源:** [devblogs.microsoft.com/oldnewthing](https://devblogs.microsoft.com/oldnewthing)
**发布时间:** Mon, 09 Feb 2026 15:00:00 +0000
**链接:** https://devblogs.microsoft.com/oldnewthing/20260209-00/?p=112049

---

{'type': 'text/html', 'language': None, 'base': 'https://devblogs.microsoft.com/oldnewthing/feed', 'value': '<p>If you call a wait function like <code>Wait\xadFor\xadSingle\xadObject</code> and receive the code <code>WAIT_ABANDONED</code>, what does it mean and what should you do?</p>\n<p>The documentation says that <code>WAIT_ABANDONED</code> means that you successfully claimed a mutex, but the thread that previously owned the mutex failed to release the mutex before it exited. This could be an oversight because the code encountered a code path that forgot to release the mutex. Or it could be because the thread crashed before it could release the mutex.</p>\n<p>The documentation also suggests that &#8220;If the mutex was protecting persistent state information, you should check it for consistency.&#8221; This is to handle the second case: The thread crashes before it can release the mutex. If the purpose of the mutex was to prevent other threads from accessing the data while it is in an inconsistent state, then the fact that the thread crashed while holding the mutex means that the data might still be in that inconsistent state.</p>\n<p>Now, maybe you have no way to check whether the data is in an inconsistent state or have no way to repair it if such an inconsistent state is discovered. (Most people don&#8217;t bother to design their data structures with rollback or transactions, because the point of the mutex was to avoid having to write that fancy code in the first place!) In that case, you really have only two choices.</p>\n<p>One option is to just cover your ears and pretend you didn&#8217;t hear anything. Just continue operating normally and hope that any latent corruption is not going to cause major problems.</p>\n<p>Another option is to give up and abandon the operation. However, if that&#8217;s your choice, you have to give up properly.</p>\n<p>The abandoned state is not sticky; is reported only to the <i>first</i> person to wait for the mutex after it was abandoned. Subsequent waits succeed normally. Therefore, if you decide, &#8220;Oh it&#8217;s corrupted, I&#8217;m not touching it,&#8221; and release the mutex and walk away, then the next person to wait for the mutex will receive a normal successful wait, and they will dive in, unaware that the data structures are corrupted!</p>\n<p>One solution is to add a flag inside your data that says &#8220;Possibly corrupted.&#8221; The code that detects the <code>WAIT_ABANDONED</code> can set that flag, and everybody who acquires the mutex can check the flag to decide if they want to take a chance by operating on corrupted data.</p>\n<p>I&#8217;m not saying that you have to do it that way, but it&#8217;s a choice you&#8217;re making. In for a penny, in for a pound.</p>\n<p>In summary, here are some options when you encounter an abandoned mutex:</p>\n<ul>\n<li>Try to fix the problem.</li>\n<li>Ignore the problem.</li>\n<li>Give up and create a warning to others.</li>\n<li><span style="text-decoration: line-through;">Give up and make everybody else think that everything is fine</span>.</li>\n</ul>\n<p>The final choice doesn&#8217;t make sense, because if you&#8217;re going to make everybody else think that everything is fine, then that&#8217;s the same as having everybody else simply ignore the problem. In which case, you may as well ignore the problem too!</p>\n<p><b>Related reading</b>: <a href="https://devblogs.microsoft.com/oldnewthing/20050912-14/?p=34253" title="Understanding the consequences of WAIT_ABANDONED"> Understanding the consequences of WAIT_ABANDONED</a>.</p>\n<p><b>Bonus chatter</b>: Don&#8217;t forget that if you get <code>WAIT_ABANDONED</code>, the mutex <i>is owned by you</i>, so make sure to release it.</p>\n<p>The post <a href="https://devblogs.microsoft.com/oldnewthing/20260209-00/?p=112049">What should I do if a wait call reports &lt;CODE&gt;WAIT_&lt;WBR&gt;ABANDONED&lt;/CODE&gt;?</a> appeared first on <a href="https://devblogs.microsoft.com/oldnewthing">The Old New Thing</a>.</p>'}

---

*抓取时间: 2026-02-10 06:03:11*
