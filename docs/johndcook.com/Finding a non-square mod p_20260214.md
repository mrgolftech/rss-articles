# Finding a non-square mod p

**来源:** [johndcook.com](https://johndcook.com)
**发布时间:** Sat, 14 Feb 2026 21:35:54 +0000
**链接:** https://www.johndcook.com/blog/2026/02/14/finding-a-non-square/

---

{'type': 'text/html', 'language': None, 'base': 'https://www.johndcook.com/blog/feed/', 'value': '<p>The <a href="https://www.johndcook.com/blog/2026/02/12/pythagorean-primes/">previous post</a> briefly mentioned Stan Wagon&#8217;s algorithm for expressing an odd prime <em>p</em> as a sum of two squares when it is possible (i.e. when <em>p</em> = 1 mod 4). Wagon&#8217;s algorithm requires first finding a non-square mod\xa0<em>p</em>, i.e. a number <em>c</em> such that <em>c</em> ≠ <em>d</em>² mod <em>p</em> for any <em>d</em> in 1, 2, 3, … <em>p</em> − 1.</p>\n<p>Wagon recommends searching for <em>c</em> by testing consecutive primes <em>q</em> as candidates. You can test whether a number <em>q</em> is a square mod <em>p</em> by computing the <a href="https://www.johndcook.com/blog/2019/02/12/computing-jacobi-symbols/">Legendre symbol</a>, which is implemented in SymPy as <code>legendre_symbol(q, p)</code>. This returns 1 if <em>q</em> is a quadratic residue mod <em>p</em> and −1 if it is not.</p>\n<p>Here&#8217;s Python code for doing the search.</p>\n<pre>from sympy import *\n\ndef find_nonresidue(p):\n    q = 2\n    while legendre_symbol(q, p) == 1:\n        q = nextprime(q)\n    return q\n</pre>\n<p>Let&#8217;s start with\xa0<em>p</em> = 2<sup>255</sup> − 19. This prime comes up often in cryptography, such as <a href="https://www.johndcook.com/blog/2019/03/09/curve25519/">Curve25519</a>. Now\xa0<em>p</em> = 1 mod 4, so Wagon&#8217;s algorithm applies.</p>\n<p>The code above returns 2, i.e. the first thing we tried worked. That was kinda disappointingly easy.</p>\n<p>Here&#8217;s another large prime used in cryptography, in the NIST curve <a href="https://www.johndcook.com/blog/2019/05/11/elliptic-curve-p-384/">P-384</a>.</p>\n<p style="padding-left: 40px;"><em>p</em> = 2<sup>384</sup> − 2<sup>128</sup> − 2<sup>96</sup> + 2<sup>32</sup> − 1</p>\n<p>For this value of <em>p</em>, <code>find_nonresidue(p)</code> returns 19.</p>\n<p>Why test prime as candidates for non-residues? You could pick candidates at random, and there&#8217;s a probability 1/2 that any candidate will work, since half the integers less than\xa0<em>p</em> are residues and half are non-residues. It&#8217;s very\xa0<em>likely</em> that you&#8217;d find a solution quickly, but it&#8217;s not guaranteed. In principle, you\xa0<em>could</em> try a thousand candidates before one works, though that&#8217;s vanishingly unlikely. If you test consecutive primes, there is a theoretical limit on how many guesses you need to make, if the Extended Riemann Hypothesis is true.</p>\n<p>The <a href="https://www.johndcook.com/blog/2026/02/14/square-root-minus-1-mod-p/">next post</a> explains why we wanted to find a non-residue.</p>The post <a href="https://www.johndcook.com/blog/2026/02/14/finding-a-non-square/">Finding a non-square mod p</a> first appeared on <a href="https://www.johndcook.com/blog">John D. Cook</a>.'}

---

*抓取时间: 2026-02-18 18:04:21*
